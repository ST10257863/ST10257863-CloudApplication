@model int

@{
	ViewData["Title"] = "Home Page";
	int? userID = ViewData["userID"] as int?;
	var products = ViewData["products"] as List<CloudApplication.Models.ProductModel>;
}

<div class="text-center">
	<h1 class="display-4">Welcome</h1>
	<p>This would be the landing page for the KhumaloCraft.</p>
	<p>Jamie Parker - ST10257863.</p>
</div>


@if (userID.HasValue)
{
	<p>User ID: @userID</p>
}
else
{
	<p>User ID: Not Logged In</p>
}

<h2>All Products</h2>

<!-- Display messages from TempData -->
@if (TempData["SuccessMessage"] != null)
{
	<div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
	<div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<table class="table">
	<thead>
		<tr>
			<th>Name</th>
			<th>Price</th>
			<th>Category</th>
			<th>Availability</th>
			<th>Action</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var product in products)
		{
			<tr>
				<td>@product.Name</td>
				<td>@product.Price</td>
				<td>@product.Category</td>
				<td>@product.Availability</td>
				<td>
					<form asp-controller="transaction" asp-action="PlaceOrder" method="post">
						<input type="hidden" name="productID" value="@product.ProductID" />
						<input type="hidden" name="quantity" value="1" /> <!-- Default quantity to 1 -->
						<button type="submit" class="btn btn-primary">Place Order</button>
					</form>

				</td>
			</tr>
		}

	</tbody>
	<p><a href="https://localhost:7282/Home/Transaction">View all current transactions.</a></p>
</table>

@* <!-- Order Modal -->
<div class="modal fade" id="orderModal" tabindex="-1" role="dialog" aria-labelledby="orderModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="orderModalLabel">Place Order</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="orderForm" asp-controller="Transaction" asp-action="PlaceOrder" method="post">
					<input type="hidden" name="productID" id="productID" />
					<div class="form-group">
						<label for="productName">Product Name</label>
						<input type="text" class="form-control" id="productName" readonly />
					</div>
					<div class="form-group">
						<label for="productPrice">Product Price</label>
						<input type="text" class="form-control" id="productPrice" readonly />
					</div>
					<div class="form-group">
						<label for="quantity">Quantity</label>
						<input type="number" class="form-control" name="quantity" id="quantity" value="1" min="1" required />
					</div>
					<button type="submit" class="btn btn-primary">Submit Order</button>
				</form>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		$('#orderModal').on('show.bs.modal', function (event) {
			var button = $(event.relatedTarget); // Button that triggered the modal
			var productID = button.data('product-id'); // Extract info from data-* attributes
			var productName = button.data('product-name');
			var productPrice = button.data('product-price');

			var modal = $(this);
			modal.find('.modal-title').text('Place Order for ' + productName);
			modal.find('#productID').val(productID);
			modal.find('#productName').val(productName);
			modal.find('#productPrice').val(productPrice);
		});
	</script>
} *@